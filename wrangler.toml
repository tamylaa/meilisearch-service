name = "meilisearch-gateway"
main = "gateway/src/index.ts"
compatibility_date = "2024-01-15"
compatibility_flags = ["nodejs_compat"]

# Development/default environment variables
[vars]
MEILISEARCH_HOST = "https://meilisearch-service-production-01e0.up.railway.app"
MEILISEARCH_URL = "https://meilisearch-service-production-01e0.up.railway.app"
ALLOWED_ORIGINS = "*"

[env.staging]
name = "meilisearch-gateway-staging"
# No custom route - uses workers.dev domain

[env.staging.vars]
MEILISEARCH_HOST = "https://meilisearch-service-production-01e0.up.railway.app"
MEILISEARCH_URL = "https://meilisearch-service-production-01e0.up.railway.app"
ALLOWED_ORIGINS = "https://tamyla.com,https://*.tamyla.com,http://localhost:3000"

[env.production]
name = "meilisearch-gateway"
route = { pattern = "search.tamyla.com/*", zone_name = "tamyla.com" }

[env.production.vars]
MEILISEARCH_HOST = "https://meilisearch-service-production-01e0.up.railway.app"
MEILISEARCH_URL = "https://meilisearch-service-production-01e0.up.railway.app"
ALLOWED_ORIGINS = "https://tamyla.com,https://*.tamyla.com"

# Secrets to be set via: wrangler secret put <name> [--env environment]
# MEILI_MASTER_KEY - from Railway
# MEILI_SEARCH_KEY - from Railway  
# AUTH_JWT_SECRET - for JWT token validation
# AUTH_JWT_SECRET (generate a random secret)

# Optional: D1 database binding if needed
# [[d1_databases]]
# binding = "DB"
# database_name = "content-skimmer-db"
# database_id = "your-d1-database-id"

# Optional: Analytics binding
# [analytics_engine_datasets]
# binding = "ANALYTICS"
